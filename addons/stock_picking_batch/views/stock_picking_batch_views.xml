<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="stock_picking_batch_filter" model="ir.ui.view">
        <field name="name">stock.picking.batch.filter</field>
        <field name="model">stock.picking.batch</field>
        <field name="arch" type="xml">
            <search string="Search Batch Transfer">
                <field name="name" string="Batch Transfer" />
                <field name="picking_type_id" invisible="1" />
                <field name="user_id" />
                <filter name="to_do_transfers" string="To Do"
                    domain="['&amp;',('user_id', 'in', [uid, False]),('state','not in',['done','cancel'])]" />
                <filter name="my_transfers" string="My Transfers" domain="[('user_id', '=', uid)]" />
                <separator />
                <filter name="draft" string="Draft" domain="[('state', '=', 'draft')]" />
                <filter name="in_progress" string="In Progress"
                    domain="[('state', '=', 'in_progress')]" help="Batch Transfers not finished" />
                <filter name="done" string="Done" domain="[('state', '=', 'done')]" />
                <separator />
                <filter invisible="1" string="Late Activities" name="activities_overdue"
                    domain="[('my_activity_date_deadline', '&lt;', context_today().strftime('%Y-%m-%d'))]"
                    help="Show all records which has next action date is before today" />
                <filter invisible="1" string="Today Activities" name="activities_today"
                    domain="[('my_activity_date_deadline', '=', context_today().strftime('%Y-%m-%d'))]" />
                <filter invisible="1" string="Future Activities" name="activities_upcoming_all"
                    domain="[('my_activity_date_deadline', '&gt;', context_today().strftime('%Y-%m-%d'))]" />
                <group expand="0" string="Group By">
                    <filter string="Responsible" name="user" domain="[]"
                        context="{'group_by': 'user_id'}" />
                    <filter string="State" name="state" domain="[]" context="{'group_by': 'state'}" />
                </group>
            </search>
        </field>
    </record>

    <record id="stock_picking_batch_tree" model="ir.ui.view">
        <field name="name">stock.picking.batch.list</field>
        <field name="model">stock.picking.batch</field>
        <field name="arch" type="xml">
            <list string="Stock Batch Transfer" multi_edit="1" sample="1"
                class="oe_stock_picking_batch">
                <field name="company_id" column_invisible="True" />
                <field name="name" decoration-bf="1" />
                <field name="description" />
                <field name="scheduled_date" readonly="state in ['cancel', 'done']" />
                <field name="user_id" widget="many2one_avatar_user"
                    readonly="state not in ['draft', 'in_progress']" />
                <field name="picking_type_id" readonly="state != 'draft'" />
                <field name="company_id" optional="hide" groups="base.group_multi_company" />
                <field name="state" widget="badge" decoration-success="state == 'done'"
                    decoration-info="state in ('draft', 'in_progress')"
                    decoration-danger="state == 'cancel'" />
                <field name="activity_exception_decoration" widget="activity_exception" />
            </list>
        </field>
    </record>

    <record id="stock_picking_wave_tree" model="ir.ui.view">
        <field name="name">stock.picking.wave.list</field>
        <field name="model">stock.picking.batch</field>
        <field name="priority">25</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="stock_picking_batch.stock_picking_batch_tree" />
        <field name="arch" type="xml">
            <xpath expr="//list" position="attributes">
                <attribute name="create">0</attribute>
            </xpath>
            <xpath expr="//list" position="inside">
                <header>
                    <button string="Prepare Wave" class="btn btn-primary" type="action"
                        display="always"
                        name="stock_picking_batch.action_prepare_wave" />
                </header>
            </xpath>
        </field>
    </record>

    <record id="stock_picking_batch_kanban" model="ir.ui.view">
        <field name="name">stock.picking.batch.kanban</field>
        <field name="model">stock.picking.batch</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile oe_stock_picking_batch" sample="1">
                <field name="company_id" />
                <templates>
                    <t t-name="card">
                        <div class="d-flex">
                            <field name="name" class="fw-bolder fs-5" />
                            <field name="state" widget="label_selection" class="ms-auto" />
                        </div>
                        <field name="description" class="fw-bold mb-2" />
                        <footer class="pt-0">
                            <field name="picking_type_id" readonly="state != 'draft'" />
                            <div class="d-flex">
                                <field name="scheduled_date" readonly="state in ['cancel', 'done']" />
                                <field name="user_id" widget="many2one_avatar_user"
                                    readonly="state not in ['draft', 'in_progress']" />
                            </div>
                        </footer>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="stock_picking_wave_kanban" model="ir.ui.view">
        <field name="name">stock.picking.wave.kanban</field>
        <field name="model">stock.picking.batch</field>
        <field name="priority">25</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="stock_picking_batch.stock_picking_batch_kanban" />
        <field name="arch" type="xml">
            <xpath expr="//kanban" position="attributes">
                <attribute name="create">0</attribute>
            </xpath>
            <xpath expr="//kanban" position="inside">
                <header>
                    <button string="Prepare Wave" class="btn btn-primary" type="action"
                        display="always"
                        name="stock_picking_batch.action_prepare_wave" />
                </header>
            </xpath>
        </field>
    </record>

    <record id="stock_picking_batch_calendar" model="ir.ui.view">
        <field name="name">stock.picking.batch.calendar</field>
        <field name="model">stock.picking.batch</field>
        <field name="priority" eval="2" />
        <field name="arch" type="xml">
            <calendar string="Calendar View" date_start="scheduled_date" event_limit="5"
                quick_create="0">
                <field name="scheduled_date" />
            </calendar>
        </field>
    </record>

    <record id="stock_picking_batch_form" model="ir.ui.view">
        <field name="name">stock.picking.batch.form</field>
        <field name="model">stock.picking.batch</field>
        <field name="arch" type="xml">
            <form string="Stock Batch Transfer">
                <field name="company_id" invisible="1" />
                <field name="show_check_availability" invisible="1" />
                <field name="show_allocation" invisible="1" />
                <field name="picking_type_code" invisible="1" />
                <field name="is_wave" invisible="1" />
                <field name="show_lots_text" invisible="1" />
                <header>
                    <button name="action_confirm" string="Confirm"
                        type="object" class="oe_highlight"
                        invisible="state != 'draft'" />
                    <button name="action_done" string="Validate"
                        type="object" class="oe_highlight"
                        invisible="state != 'in_progress' or show_check_availability" />
                    <button name="action_assign" string="Check Availability"
                        type="object" class="oe_highlight"
                        invisible="state != 'in_progress' or not show_check_availability" />
                    <button name="action_done" string="Validate"
                        type="object"
                        invisible="state != 'in_progress' or not show_check_availability" />
                    <button name="action_assign" string="Check Availability"
                        type="object"
                        invisible="state != 'draft' or not show_check_availability" />
                    <button name="action_print" string="Print"
                        type="object"
                        invisible="state not in ('in_progress', 'done')" />
                    <button name="action_open_label_layout" string="Print Labels"
                        type="object" />
                    <button name="action_cancel" string="Cancel"
                        type="object"
                        invisible="state != 'in_progress'" />
                    <field name="state" widget="statusbar"
                        statusbar_visible="draft,in_progress,done" />
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_view_reception_report" string="Allocation"
                            type="object" class="oe_stat_button"
                            icon="fa-list"
                            invisible="not show_allocation"
                            groups="stock.group_reception_report" />
                    </div>
                    <div class="oe_title">
                        <h1>
                            <field name="name" class="oe_inline" />
                        </h1>
                    </div>
                    <group>
                        <group id="batch_delivery_data">
                            <field name="user_id" readonly="state not in ['draft', 'in_progress']" />
                            <field name="picking_type_id" readonly="state != 'draft'" />
                            <field name="company_id"
                                readonly="picking_ids" force_save="1" groups="base.group_multi_company" />
                            <field name="scheduled_date" readonly="state in ['cancel', 'done']" />
                            <field name="description" />
                        </group>
                        <field name="properties" nolabel="1" columns="2" hideAddButton="1" />
                    </group>
                    <notebook>
                        <page name="page_detailed_operations" string="Detailed Operations"
                            invisible="state == 'draft'">
                            <field name="move_line_ids"
                                context="{'list_view_ref': 'stock_picking_batch.view_move_line_tree'}"
                                readonly="state not in ['draft', 'in_progress']" />
                            <button name="action_put_in_pack" string="Put in Pack"
                                type="object" class="oe_highlight"
                                invisible="state in ('draft', 'done', 'cancel')"
                                groups="stock.group_tracking_lot" />
                        </page>
                        <page name="page_operations" string="Operations"
                            invisible="state == 'draft'">
                            <field name="move_ids"
                                context="{'list_view_ref': 'stock_picking_batch.view_picking_move_tree_inherited'}" />
                        </page>
                        <page name="page_transfers" string="Transfers">
                            <field name="allowed_picking_ids" invisible="1" />
                            <field name="picking_ids" widget="many2many"
                                mode="list,kanban"
                                context="{'form_view_ref': 'stock_picking_batch.view_picking_form_inherited', 'list_view_ref': 'stock_picking_batch.stock_picking_view_batch_tree_ref'}"
                                readonly="state not in ['draft', 'in_progress']" />
                        </page>
                    </notebook>
                </sheet>
                <chatter />
            </form>
        </field>
    </record>

    <record id="stock_picking_batch_action" model="ir.actions.act_window">
        <field name="name">Batch Transfers</field>
        <field name="res_model">stock.picking.batch</field>
        <field name="view_mode">list,kanban,form</field>
        <field name="search_view_id" ref="stock_picking_batch_filter" />
        <field name="domain">[('is_wave', '=', False)]</field>
        <field name="context">{'search_default_draft': True, 'search_default_in_progress': True}</field>
        <field name="help" type="html">
            <div class="container mt-5">
                <div class="row g-5">
                    <div class="col-lg-4" style="opacity: 0.5;">
                        <img src="/stock_picking_batch/static/shapes/wave-picking.svg"
                            class="shadow rounded-3 w-100 mb-4" />
                        <h5>Wave transfers</h5>
                        <p class="small">Launch picking orders by aisle or area and regroup at
                            packing zone. Ideal for large warehouses.</p>
                    </div>
                    <div class="col-lg-4">
                        <img src="/stock_picking_batch/static/shapes/batch-picking.svg"
                            class="shadow rounded-3 w-100 mb-4" />
                        <h5>Batch transfers</h5>
                        <p class="small">Regroup multiple orders into one picking and consolidate at
                            the packing zone.</p>
                    </div>
                    <div class="col-lg-4">
                        <img src="/stock_picking_batch/static/shapes/cluster-picking.svg"
                            class="shadow rounded-3 w-100 mb-4" />
                        <h5>Cluster transfers</h5>
                        <p class="small">Pick multiple orders in one trip and prepare orders as you
                            pick. This reduces packing time and is ideal for small products.</p>
                    </div>
                </div>
            </div>
        </field>
    </record>

    <record id="action_picking_tree_wave" model="ir.actions.act_window">
        <field name="name">Wave Transfers</field>
        <field name="res_model">stock.picking.batch</field>
        <field name="view_mode">list,kanban,form</field>
        <field name="search_view_id" ref="stock_picking_batch_filter" />
        <field name="context">{'search_default_draft': True, 'search_default_in_progress': True}</field>
        <field name="view_ids"
            eval="[
                (5, 0, 0),
                (0, 0, {'view_mode': 'list', 'view_id': ref('stock_picking_batch.stock_picking_wave_tree')}),
                (0, 0, {'view_mode': 'kanban', 'view_id': ref('stock_picking_batch.stock_picking_wave_kanban')})
            ]" />
        <field name="domain">[('is_wave', '=', True)]</field>
        <field name="help" type="html">
            <div class="container mt-5">
                <div class="row g-5">
                    <div class="col-lg-4">
                        <img src="/stock_picking_batch/static/shapes/wave-picking.svg"
                            class="shadow rounded-3 w-100 mb-4" />
                        <h5>Wave transfers</h5>
                        <p class="small">Launch picking orders by aisle or area and regroup at
                            packing zone. Ideal for large warehouses.</p>
                    </div>
                    <div class="col-lg-4" style="opacity: 0.5;">
                        <img src="/stock_picking_batch/static/shapes/batch-picking.svg"
                            class="shadow rounded-3 w-100 mb-4" />
                        <h5>Batch transfers</h5>
                        <p class="small">Regroup multiple orders into one picking and consolidate at
                            the packing zone.</p>
                    </div>
                    <div class="col-lg-4">
                        <img src="/stock_picking_batch/static/shapes/cluster-picking.svg"
                            class="shadow rounded-3 w-100 mb-4" />
                        <h5>Cluster transfers</h5>
                        <p class="small">Pick multiple orders in one trip and prepare orders as you
                            pick. This reduces packing time and is ideal for small products.</p>
                    </div>
                </div>
            </div>
        </field>
    </record>

    <record id="action_unreserve_batch_picking" model="ir.actions.server">
        <field name="name">Unreserve</field>
        <field name="model_id" ref="stock_picking_batch.model_stock_picking_batch" />
        <field name="binding_model_id" ref="stock_picking_batch.model_stock_picking_batch" />
        <field name="binding_view_types">list,kanban,form</field>
        <field name="state">code</field>
        <field name="code">
if records:
    records.picking_ids.do_unreserve()
        </field>
    </record>
</odoo>