<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_picking_internal_search_inherit" model="ir.ui.view">
        <field name="name">stock.picking.internal.search.inherit</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_internal_search" />
        <field name="arch" type="xml">
            <filter name="picking_type" position="after">
                <filter name="batch" string="Batch Transfer"
                    domain="[]"
                    context="{'group_by': 'batch_id'}" />
            </filter>
        </field>
    </record>

    <record id="view_picking_internal_search_inherit_stock_picking_batch" model="ir.ui.view">
        <field name="name">stock.picking.search</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_internal_search" />
        <field name="arch" type="xml">
            <xpath expr="//field[@name='product_id']" position="after">
                <field name="batch_id" />
            </xpath>
        </field>
    </record>

    <record id="vpicktree" model="ir.ui.view">
        <field name="name">stock.picking.list.inherit.stock.picking.batch</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.vpicktree" />
        <field name="arch" type="xml">
            <field name="picking_type_id" position="after">
                <field name="batch_id"
                    readonly="state in ['cancel', 'done']"
                    domain="[
                        ('state', 'in', ['draft', 'in_progress']),
                        '|',
                            ('picking_type_id', '=', picking_type_id),
                            ('picking_type_id', '=', False),
                    ]"
                    context="{'default_picking_type_id': picking_type_id}"
                    optional="show" />
            </field>
        </field>
    </record>

    <record id="stock_picking_view_batch_tree_ref" model="ir.ui.view">
        <field name="name">stock.picking.view.list.inherit.stock.picking.batch</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.vpicktree" />
        <field name="mode">primary</field>
        <field name="arch" type="xml">
            <xpath expr="//list" position="attributes">
                <attribute name="default_order">batch_sequence</attribute>
            </xpath>
            <field name="company_id" position="before">
                <field name="batch_sequence" widget="handle" />
            </field>
            <field name="company_id" position="replace" />
            <field name="batch_id" position="replace" />
            <field name="date_planned" position="attributes">
                <attribute name="optional">hide</attribute>
            </field>
        </field>
    </record>

    <record id="view_picking_form_inherited" model="ir.ui.view">
        <field name="name">stock_picking_batch.picking.form</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_form"/>
        <field name="mode">primary</field>
        <field name="priority" eval="1000"/>
        <field name="arch" type="xml">
            <xpath expr="//header" position="replace">
                <header>
                    <field name="state" widget="statusbar" statusbar_visible="draft,confirmed,assigned,done"/>
                </header>
            </xpath>
        </field>
    </record>

    <record id="stock_picking_form_inherit" model="ir.ui.view">
        <field name="name">stock.picking.form.inherit</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_form" />
        <field name="arch" type="xml">
            <div name="button_box" position="inside">
                <button name="action_view_batch" string="Batch"
                    type="object" class="oe_stat_button"
                    icon="fa-truck"
                    invisible="not batch_id" />
            </div>
            <xpath expr="//page[@name='extra']//field[@name='company_id']" position="after">
                <field name="batch_id"
                    readonly="1"
                    options="{'no_create': True}" />
            </xpath>
        </field>
    </record>
</odoo>
