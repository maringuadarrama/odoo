<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="stock_move_line_view_search_inherit_stock_picking_batch" model="ir.ui.view">
        <field name="name">stock.move.line.search.stock_picking_batch</field>
        <field name="model">stock.move.line</field>
        <field name="inherit_id" ref="stock.stock_move_line_view_search" />
        <field name="arch" type="xml">
            <xpath expr="//group[@name='groupby']" position="inside">
                <filter string="Batch Transfer" name="by_batch_id"
                    context="{'group_by': 'batch_id'}" />
            </xpath>
        </field>
    </record>

    <record id="view_move_line_tree_detailed_wave" model="ir.ui.view">
        <field name="name">stock_picking_wave.move.line.list.wave</field>
        <field name="model">stock.move.line</field>
        <field name="inherit_id" ref="stock.view_move_line_tree_detailed" />
        <field name="arch" type="xml">
            <xpath expr="//list" position="inside">
                <header>
                    <button name="action_open_add_to_wave" string="Add to Wave" type="object" />
                </header>
            </xpath>
            <xpath expr="//field[@name='picking_id']" position="after">
                <field name="batch_id" optional="show" />
            </xpath>
        </field>
    </record>

    <record id="view_move_line_tree_inherit_stock_picking_batch" model="ir.ui.view">
        <field name="name">stock.move.line.list.stock_picking_batch</field>
        <field name="model">stock.move.line</field>
        <field name="inherit_id" ref="stock.view_move_line_tree" />
        <field name="arch" type="xml">
            <xpath expr="//field[@name='state']" position="after">
                <field name="batch_id" optional="hide" />
            </xpath>
        </field>
    </record>

    <record id="view_move_line_tree" model="ir.ui.view">
        <field name="name">stock_picking_batch.move.line.list</field>
        <field name="model">stock.move.line</field>
        <field name="arch" type="xml">
            <list editable="top" decoration-muted="state == 'cancel'" string="Move Lines"
                default_order="location_id">
                <field name="tracking" column_invisible="True" />
                <field name="state" column_invisible="True" />
                <field name="company_id" column_invisible="True" />
                <field name="product_id" context="{'default_is_storable': True}" required="1"
                    readonly="id" />
                <field name="picking_id" required="1" readonly="id"
                    options="{'no_create_edit': True}" domain="[('id', 'in', parent.picking_ids)]" />
                <field name="lot_id"
                    readonly="tracking not in ['lot', 'serial']"
                    column_invisible="parent.show_lots_text" groups="stock.group_production_lot" />
                <field name="lot_name"
                    readonly="tracking not in ['lot', 'serial']"
                    column_invisible="not parent.show_lots_text" groups="stock.group_production_lot" />
                <field name="location_id" />
                <field name="location_dest_id" />
                <field name="package_id" groups="stock.group_tracking_lot" />
                <field name="result_package_id" groups="stock.group_tracking_lot" />
                <field name="product_uom_id" options="{'no_create': True}" widget="many2one_uom"
                    readonly="1" force_save="1" groups="uom.group_uom" />
                <field name="quantity" />
                <field name="company_id" force_save="1" groups="base.group_multi_company" />
            </list>
        </field>
    </record>

    <record id="action_prepare_wave_for_picking_type" model="ir.actions.act_window">
        <field name="name">Prepare Wave</field>
        <field name="res_model">stock.move.line</field>
        <field name="view_mode">list</field>
        <field name="view_id" ref="view_move_line_tree_detailed_wave" />
        <field name="target">new</field>
        <field name="domain">[
            ('state', '!=', 'done'),
            ('picking_type_id', '=', active_id),
            ('picking_id', '!=', False)
        ]</field>
        <field name="context">{'active_wave_id': False, 'search_default_by_location': True}</field>
    </record>

    <record id="action_prepare_wave" model="ir.actions.act_window">
        <field name="name">Prepare Wave</field>
        <field name="res_model">stock.move.line</field>
        <field name="view_mode">list</field>
        <field name="view_id" ref="view_move_line_tree_detailed_wave" />
        <field name="target">new</field>
        <field name="domain">[('state', '!=', 'done'), ('picking_id', '!=', False)]</field>
        <field name="context">{'active_wave_id': False, 'search_default_by_location': True}</field>
    </record>
</odoo>
